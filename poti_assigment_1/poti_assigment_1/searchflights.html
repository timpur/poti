<!DOCTYPE html>
<html>
<head>
	<title></title>
	<meta charset="utf-8" />
	<script src="scripts/jquery-3.2.1.min.js"></script>
	<link href="styles/material.min.css" rel="stylesheet" />
	<script src="scripts/material.min.js"></script>
	<link rel="stylesheet" href="https://fonts.googleapis.com/icon?family=Material+Icons" />
	<script src="scripts/common.js"></script>
	<style type="text/css"></style>
	<script type="text/javascript">

		$(document).ready(function () {
			$("#flightform").submit(checkFlightForm);


			showFlightTable(false);
			getFlights("", "");
		});

		function getFlights(from, to) {
			var data = { "from": from, "to": to };
			callPHP("php/searchflights.php", data, displayFlights);
		}

		function searchBTNClick() {
			var from = $("#searchFrom").val();
			var to = $("#searchTo").val();
			getFlights(from, to);
		}

		function displayFlights(data) {
			if (data && data.length > 0) {
				$("#flighttablebody").children().remove();
				for (var i = 0; i < data.length; ++i) {
					addFlightToTable(data[i]);
				}
				showFlightTable(true);
			}
			else {
				showFlightTable(false);
			}
		}

		function addFlightToTable(flight) {
			var tableBody = $("#flighttablebody");
			var flightRow = $("<tr>");
			flightRow.append($('<td class="mdl-data-table__cell--non-numeric">').text(flight.from));
			flightRow.append($('<td class="mdl-data-table__cell--non-numeric">').text(flight.to));
			flightRow.append($('<td class="mdl-data-table__cell--non-numeric">').append(
				$("<input>", {
					"type": "radio",
					"name": "selection",
					"value": flight.route
			})));

			tableBody.append(flightRow);
		}

		function showFlightTable(show) {
			var flightstable = $("#flightform");
			var noresults = $("#noresultscontainer");
			if (show) {
				flightstable.show()
				noresults.hide();
			}
			else {
				flightstable.hide()
				noresults.show();
			}
		}

		function checkFlightForm(event) {
			var success = true;
			var selectedRadio = $("#flighttable input[name='selection']:checked");
			if (selectedRadio.length == 0) {
				var data = { message: 'Please select a Flight' };
				var snackbarContainer = $("#toast")[0];
				snackbarContainer.MaterialSnackbar.showSnackbar(data);
				success = false;
			}
			return success;
		}

	</script>
</head>
<body style="text-align:center;">
	<h1>Search for Flights</h1>
	<div id="search">
		<h3>Search</h3>
		<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
			<label class="mdl-textfield__label" for="searchFrom">From Location</label>
			<input class="mdl-textfield__input" type="text" id="searchFrom" name="from" />
		</div>
		<div class="mdl-textfield mdl-js-textfield mdl-textfield--floating-label">
			<label class="mdl-textfield__label" for="searchTo">To Location</label>
			<input class="mdl-textfield__input" type="text" id="searchTo" name="to" />
		</div>
		<button class="mdl-button mdl-js-button mdl-button--fab mdl-button--colored" onclick="searchBTNClick()">
			<i class="material-icons">search</i>
		</button>
	</div>
	<div>
		<h3>Flight Results</h3>
		<form id="flightform" action="seatselection.php" method="get">
			<table id="flighttable" class="mdl-data-table mdl-js-data-table mdl-shadow--2dp" style="margin:auto; width:auto">
				<thead>
					<tr>
						<th class="mdl-data-table__cell--non-numeric">From</th>
						<th class="mdl-data-table__cell--non-numeric">To</th>
						<th class="mdl-data-table__cell--non-numeric">Select</th>
					</tr>
				</thead>
				<tbody id="flighttablebody"></tbody>
			</table>
			<br />
			<button class="mdl-button mdl-js-button mdl-button--raised mdl-js-ripple-effect mdl-button--colored" type="submit">Next</button>
		</form>
		<div id="noresultscontainer">
			<p>No Results Foud</p>
			<p>Please try again</p>
		</div>
	</div>
	<div id="toast" class="mdl-js-snackbar mdl-snackbar">
		<div class="mdl-snackbar__text"></div>
		<button class="mdl-snackbar__action" type="button"></button>
	</div>
</body>
</html>
